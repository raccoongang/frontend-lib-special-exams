{"version":3,"sources":["../../../src/data/messages/handlers.js"],"names":["createWorker","url","blob","Blob","type","blobUrl","window","URL","createObjectURL","Worker","workerTimeoutPromise","timeoutMilliseconds","message","Promise","resolve","reject","setTimeout","Error","workerPromiseForEventNames","eventNames","workerUrl","timeout","proctoringBackendWorker","responseHandler","e","data","successEventName","removeEventListener","terminate","error","addEventListener","postMessage","promptEventName","pingApplication","timeoutInSeconds","TIMEOUT_BUFFER_SECONDS","workerPingTimeout","race","actionToMessageTypesMap","ping"],"mappings":";;;;;;;;AAAA;;;;AAEA,SAASA,YAAT,CAAsBC,GAAtB,EAA2B;AACzB,MAAMC,IAAI,GAAG,IAAIC,IAAJ,CAAS,0BAAmBF,GAAnB,SAAT,EAAuC;AAAEG,IAAAA,IAAI,EAAE;AAAR,GAAvC,CAAb;AACA,MAAMC,OAAO,GAAGC,MAAM,CAACC,GAAP,CAAWC,eAAX,CAA2BN,IAA3B,CAAhB;AACA,SAAO,IAAIO,MAAJ,CAAWJ,OAAX,CAAP;AACD;;AAED,SAASK,oBAAT,CAA8BC,mBAA9B,EAAmD;AACjD,MAAMC,OAAO,4CAAqCD,mBAArC,QAAb;AACA,SAAO,IAAIE,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCC,IAAAA,UAAU,CAAC,YAAM;AACfD,MAAAA,MAAM,CAACE,KAAK,CAACL,OAAD,CAAN,CAAN;AACD,KAFS,EAEPD,mBAFO,CAAV;AAGD,GAJM,CAAP;AAKD;;AAEM,SAASO,0BAAT,CAAoCC,UAApC,EAAgDC,SAAhD,EAA2D;AAChE,SAAO,UAACC,OAAD,EAAa;AAClB,QAAMC,uBAAuB,GAAGtB,YAAY,CAACoB,SAAD,CAA5C;AACA,WAAO,IAAIP,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,UAAMQ,eAAe,GAAG,SAAlBA,eAAkB,CAACC,CAAD,EAAO;AAC7B,YAAIA,CAAC,CAACC,IAAF,CAAOrB,IAAP,KAAgBe,UAAU,CAACO,gBAA/B,EAAiD;AAC/CJ,UAAAA,uBAAuB,CAACK,mBAAxB,CAA4C,SAA5C,EAAuDJ,eAAvD;AACAD,UAAAA,uBAAuB,CAACM,SAAxB;AACAd,UAAAA,OAAO;AACR,SAJD,MAIO;AACLC,UAAAA,MAAM,CAACS,CAAC,CAACC,IAAF,CAAOI,KAAR,CAAN;AACD;AACF,OARD;;AASAP,MAAAA,uBAAuB,CAACQ,gBAAxB,CAAyC,SAAzC,EAAoDP,eAApD;AACAD,MAAAA,uBAAuB,CAACS,WAAxB,CAAoC;AAAE3B,QAAAA,IAAI,EAAEe,UAAU,CAACa,eAAnB;AAAoCX,QAAAA,OAAO,EAAPA;AAApC,OAApC;AACD,KAZM,CAAP;AAaD,GAfD;AAgBD;;AAEM,SAASY,eAAT,CAAyBC,gBAAzB,EAA2Cd,SAA3C,EAAsD;AAC3D,MAAMe,sBAAsB,GAAG,EAA/B;AACA,MAAMC,iBAAiB,GAAGF,gBAAgB,GAAGC,sBAA7C,CAF2D,CAEU;;AACrE,SAAOtB,OAAO,CAACwB,IAAR,CAAa,CAClBnB,0BAA0B,CAACoB,mBAAwBC,IAAzB,EAA+BnB,SAA/B,CAA1B,CAAoEgB,iBAAiB,GAAG,IAAxF,CADkB,EAElB1B,oBAAoB,CAACwB,gBAAgB,GAAG,IAApB,CAFF,CAAb,CAAP;AAID","sourcesContent":["import actionToMessageTypesMap from './constants';\n\nfunction createWorker(url) {\n  const blob = new Blob([`importScripts('${url}');`], { type: 'application/javascript' });\n  const blobUrl = window.URL.createObjectURL(blob);\n  return new Worker(blobUrl);\n}\n\nfunction workerTimeoutPromise(timeoutMilliseconds) {\n  const message = `worker failed to respond after ${timeoutMilliseconds} ms`;\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      reject(Error(message));\n    }, timeoutMilliseconds);\n  });\n}\n\nexport function workerPromiseForEventNames(eventNames, workerUrl) {\n  return (timeout) => {\n    const proctoringBackendWorker = createWorker(workerUrl);\n    return new Promise((resolve, reject) => {\n      const responseHandler = (e) => {\n        if (e.data.type === eventNames.successEventName) {\n          proctoringBackendWorker.removeEventListener('message', responseHandler);\n          proctoringBackendWorker.terminate();\n          resolve();\n        } else {\n          reject(e.data.error);\n        }\n      };\n      proctoringBackendWorker.addEventListener('message', responseHandler);\n      proctoringBackendWorker.postMessage({ type: eventNames.promptEventName, timeout });\n    });\n  };\n}\n\nexport function pingApplication(timeoutInSeconds, workerUrl) {\n  const TIMEOUT_BUFFER_SECONDS = 10;\n  const workerPingTimeout = timeoutInSeconds - TIMEOUT_BUFFER_SECONDS; // 10s buffer for worker to respond\n  return Promise.race([\n    workerPromiseForEventNames(actionToMessageTypesMap.ping, workerUrl)(workerPingTimeout * 1000),\n    workerTimeoutPromise(timeoutInSeconds * 1000),\n  ]);\n}\n"],"file":"handlers.js"}